<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>å°ç£è‚¡ç¥¨è¨ˆç®—å™¨ (ä¿®æ­£ç‰ˆ)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.8rem;
        }

        h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .disclaimer {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .disclaimer h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            margin-left: 20px;
            color: #856404;
        }

        .disclaimer li {
            margin-bottom: 5px;
        }

        .section-note {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 4px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }

        textarea {
            height: 100px;
            resize: vertical;
            font-family: monospace;
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .row > * {
            flex: 1;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        button.secondary {
            background-color: #95a5a6;
        }

        button.secondary:hover {
            background-color: #7f8c8d;
        }

        button.success {
            background-color: #27ae60;
        }

        button.success:hover {
            background-color: #229954;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .note {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 5px;
            line-height: 1.4;
        }

        .notice {
            font-size: 0.9rem;
            color: #555;
            margin-top: 8px;
            padding: 8px;
            background-color: #e8f4f8;
            border-radius: 4px;
        }

        .results {
            display: none;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }

        .results.show {
            display: block;
        }

        .results p {
            margin-bottom: 10px;
        }

        .results strong {
            color: #2c3e50;
        }

        .recommendation.buy {
            color: #27ae60;
            font-weight: bold;
        }

        .recommendation.sell {
            color: #c0392b;
            font-weight: bold;
        }

        .recommendation.hold {
            color: #f39c12;
            font-weight: bold;
        }

        .rsi-value.oversold {
            color: #27ae60;
            font-weight: bold;
        }

        .rsi-value.overbought {
            color: #c0392b;
            font-weight: bold;
        }

        .rsi-value.neutral {
            color: #7f8c8d;
            font-weight: bold;
        }

        .warning {
            color: #c0392b;
            font-weight: bold;
        }

        .alert-box {
            background-color: #fee;
            border: 1px solid #c0392b;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            color: #c0392b;
        }

        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å°ç£è‚¡ç¥¨è¨ˆç®—å™¨ V8</h1>
        
        <div class="section-note">
            æ­¤å·¥å…·æ•´åˆè‚¡ç¥¨é¸æ“‡èˆ‡æ™ºèƒ½åˆ†æåŠŸèƒ½ï¼Œä½¿ç”¨ FinMind API è‡ªå‹•ç²å–æ­·å²æ”¶ç›¤åƒ¹è³‡æ–™ã€‚
        </div>

        <form id="stockForm">
            <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šè‚¡ç¥¨é¸æ“‡ -->
            <h2>ä¸€ã€é¸æ“‡è‚¡ç¥¨</h2>
            
            <div class="form-group">
                <label>é¡è‚¡ï¼ˆç”¢æ¥­åˆ¥ï¼‰</label>
                <select id="industry">
                    <option value="">è¼‰å…¥ä¸­...</option>
                </select>
            </div>

            <div class="form-group">
                <label>è‚¡ç¥¨åç¨±</label>
                <select id="stockSelect">
                    <option value="">è«‹å…ˆé¸æ“‡é¡è‚¡</option>
                </select>
            </div>

            <div class="form-group">
                <label for="stockCode">è‚¡ç¥¨ä»£ç¢¼</label>
                <input type="text" id="stockCode" name="stockCode" placeholder="é¸æ“‡è‚¡ç¥¨åç¨±å¾Œè‡ªå‹•å¸¶å…¥ï¼Œæˆ–æ‰‹å‹•è¼¸å…¥ä»£ç¢¼" required>
            </div>

            <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šåƒ¹æ ¼è³‡æ–™ -->
            <h2>äºŒã€åƒ¹æ ¼è³‡æ–™</h2>

            <div class="form-group">
                <label for="buyPrice">è²·å…¥åƒ¹æ ¼</label>
                <input type="number" id="buyPrice" name="buyPrice" step="0.01" placeholder="ä¾‹å¦‚ï¼š130.00ï¼ˆè‹¥æœªè²·å…¥è«‹ç•™ç©ºï¼‰">
                <p class="note">èªªæ˜ï¼šè«‹è¼¸å…¥æ‚¨è²·å…¥æˆ–å¯¦éš›é è²·å…¥çš„åƒ¹æ ¼ï¼Œç”¨æ–¼è¨ˆç®—æ­¢æåƒ¹å’Œæœ€ä½³è³£å‡ºåƒ¹ã€‚</p>
            </div>

            <div class="form-group">
                <label for="currentPrice">ç•¶å‰åƒ¹æ ¼</label>
                <input type="number" id="currentPrice" name="currentPrice" step="0.01" placeholder="ä¾‹å¦‚ï¼š150.00" required>
            </div>

            <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ­·å²è³‡æ–™æŠ“å– -->
            <h2>ä¸‰ã€æ­·å²è³‡æ–™æŠ“å–</h2>

            <div class="row">
                <div class="form-group">
                    <label for="startDate">é–‹å§‹æ—¥æœŸï¼ˆå«ï¼‰</label>
                    <input id="startDate" type="date" required>
                </div>
                <div class="form-group">
                    <label for="endDate">çµæŸæ—¥æœŸï¼ˆå«ï¼‰</label>
                    <input id="endDate" type="date" required>
                </div>
            </div>

            <div class="button-group">
                <button type="button" id="fetchBtn">æŠ“å–æ­·å²æ”¶ç›¤åƒ¹</button>
                <button type="button" id="clearFetchBtn" class="secondary">æ¸…é™¤</button>
            </div>

            <div class="notice" id="fetchNote"></div>

            <div class="form-group">
                <label for="historicalPrices">æ­·å²æ”¶ç›¤åƒ¹ï¼ˆä»¥é€—è™Ÿåˆ†éš”ï¼‰</label>
                <textarea id="historicalPrices" name="historicalPrices" placeholder="é»æ“Šã€ŒæŠ“å–æ­·å²æ”¶ç›¤åƒ¹ã€è‡ªå‹•å¡«å…¥ï¼Œæˆ–æ‰‹å‹•è¼¸å…¥ï¼Œä¾‹å¦‚ï¼š100,102,105,98,110" required></textarea>
                <p class="note">èªªæ˜ï¼šæ­·å²æ”¶ç›¤åƒ¹æŒ‰æ™‚é–“é †åºï¼Œç”¨é€—è™Ÿåˆ†éš”ã€‚<strong>å»ºè­°è‡³å°‘ 30 å¤©ä»¥æä¾›è¼ƒé«˜æº–ç¢ºæ€§</strong>ï¼ˆæœ€å°‘éœ€ 14 å¤©è¨ˆç®— RSIï¼‰ã€‚</p>
            </div>

            <div class="form-group">
                <label for="historicalDays">æ­·å²æ•¸æ“šæœŸé–“ï¼ˆå¤©ï¼‰</label>
                <input type="number" id="historicalDays" name="historicalDays" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
            </div>

            <div class="row">
                <div class="form-group">
                    <label for="historicalLow">æ­·å²æœ€ä½åƒ¹</label>
                    <input type="number" id="historicalLow" name="historicalLow" step="0.01" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
                </div>
                <div class="form-group">
                    <label for="historicalHigh">æ­·å²æœ€é«˜åƒ¹</label>
                    <input type="number" id="historicalHigh" name="historicalHigh" step="0.01" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
                </div>
            </div>

            <div class="form-group">
                <label for="historicalAvg">æ­·å²å¹³å‡åƒ¹</label>
                <input type="number" id="historicalAvg" name="historicalAvg" step="0.01" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
            </div>

            <!-- ç¬¬å››éƒ¨åˆ†ï¼šäº¤æ˜“åƒæ•¸è¨­å®š -->
            <h2>å››ã€äº¤æ˜“åƒæ•¸è¨­å®š</h2>

            <div class="form-group">
                <label for="stopLoss">æ­¢æç™¾åˆ†æ¯”ï¼ˆ%ï¼‰</label>
                <input type="number" id="stopLoss" name="stopLoss" step="0.1" placeholder="ä¾‹å¦‚ï¼š5" min="3" max="15" value="5">
                <p class="note">èªªæ˜ï¼šå»ºè­°è¨­å®šç‚º 3-15%ï¼Œæ ¹æ“šå€‹äººé¢¨éšªæ‰¿å—èƒ½åŠ›èª¿æ•´ã€‚</p>
            </div>

            <div class="form-group">
                <label for="profitTarget">ç›ˆåˆ©ç›®æ¨™ç™¾åˆ†æ¯”ï¼ˆ%ï¼‰</label>
                <input type="number" id="profitTarget" name="profitTarget" step="0.1" placeholder="ä¾‹å¦‚ï¼š10" min="5" max="50" value="10">
                <p class="note">èªªæ˜ï¼šå»ºè­°è¨­å®šç‚º 5-50%ï¼Œæ ¹æ“šå¸‚å ´æ³¢å‹•æ€§èª¿æ•´ã€‚</p>
            </div>

            <div class="form-group">
                <label for="transactionCost">äº¤æ˜“æˆæœ¬ç™¾åˆ†æ¯”ï¼ˆ%ï¼‰</label>
                <input type="number" id="transactionCost" name="transactionCost" step="0.01" placeholder="ä¾‹å¦‚ï¼š0.5" min="0.3" max="1" value="0.5">
                <p class="note">èªªæ˜ï¼šå°ç£è‚¡å¸‚äº¤æ˜“æˆæœ¬ç´„ 0.3-0.6%ï¼ˆå«æ‰‹çºŒè²»èˆ‡è­‰äº¤ç¨…ï¼‰ã€‚</p>
            </div>

            <div class="form-group">
                <label for="slippage">æ»‘é»ç™¾åˆ†æ¯”ï¼ˆ%ï¼‰</label>
                <input type="number" id="slippage" name="slippage" step="0.01" placeholder="ä¾‹å¦‚ï¼š0.2" min="0" max="1" value="0.2">
                <p class="note">èªªæ˜ï¼šå¯¦éš›æˆäº¤åƒ¹èˆ‡é æœŸåƒ¹æ ¼çš„åå·®ï¼Œå»ºè­° 0.1-0.5%ã€‚</p>
            </div>

            <div class="form-group">
                <label for="leverage">æ§“æ¡¿å€æ•¸</label>
                <input type="number" id="leverage" name="leverage" step="0.1" placeholder="ä¾‹å¦‚ï¼š1ï¼ˆç„¡æ§“æ¡¿ï¼‰" min="1" max="3" value="1">
                <p class="note">èªªæ˜ï¼š1 è¡¨ç¤ºç„¡æ§“æ¡¿ï¼Œå°è‚¡èè³‡æœ€é«˜ç´„ 2.5 å€ã€‚<strong>æ§“æ¡¿å¢åŠ é¢¨éšªï¼Œè«‹è¬¹æ…ä½¿ç”¨</strong>ã€‚</p>
            </div>

            <div class="form-group">
                <label for="marketTrend">å¸‚å ´è¶¨å‹¢èª¿æ•´ï¼ˆ%ï¼‰</label>
                <input type="number" id="marketTrend" name="marketTrend" step="0.1" placeholder="ä¾‹å¦‚ï¼š10ï¼ˆç‰›å¸‚ï¼‰ï¼Œ-10ï¼ˆç†Šå¸‚ï¼‰" min="-30" max="30" value="0">
                <p class="note">èªªæ˜ï¼šæ ¹æ“šå¤§ç›¤èµ°å‹¢èª¿æ•´ï¼ˆå¦‚åŠ æ¬ŠæŒ‡æ•¸ï¼‰ï¼Œæ­£æ•¸ç‚ºç‰›å¸‚ï¼Œè² æ•¸ç‚ºç†Šå¸‚ã€‚å»ºè­°ç¯„åœ -30% åˆ° +30%ã€‚</p>
            </div>

            <div class="form-group">
                <label for="expectedWinRate">é æœŸå‹ç‡ï¼ˆ%ï¼‰</label>
                <input type="number" id="expectedWinRate" name="expectedWinRate" step="1" placeholder="ä¾‹å¦‚ï¼š50ï¼ˆå¯é¸ï¼‰" min="20" max="80">
                <p class="note">èªªæ˜ï¼š<strong>é¸å¡«</strong>ã€‚å¦‚æœæ‚¨æœ‰å¯¦éš›å›æ¸¬æ•¸æ“šï¼Œå¯è¼¸å…¥é æœŸå‹ç‡ã€‚ç•™ç©ºå‰‡ç”±ç³»çµ±æ ¹æ“šæŠ€è¡“æŒ‡æ¨™æ¨ä¼°ï¼ˆä½†æ¨ä¼°å€¼å¯èƒ½ä¸æº–ç¢ºï¼‰ã€‚</p>
            </div>

            <div class="form-group">
                <label for="volatility">æ³¢å‹•ç‡ï¼ˆ%ï¼‰</label>
                <input type="number" id="volatility" name="volatility" step="0.01" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
                <p class="note">èªªæ˜ï¼šæ ¹æ“šæ­·å²æ”¶ç›¤åƒ¹è‡ªå‹•è¨ˆç®—å¹´åŒ–æ³¢å‹•ç‡ã€‚</p>
            </div>

            <div class="form-group">
                <button type="submit">è¨ˆç®—åˆ†æçµæœ</button>
            </div>
        </form>

        <div id="results" class="results">
            <h2>è¨ˆç®—çµæœ</h2>
            <p><strong>è‚¡ç¥¨ä»£ç¢¼ï¼š</strong> <span id="resultStockCode"></span></p>
            <p><strong>å¯¦éš›è²·å…¥åƒ¹æ ¼ï¼š</strong> <span id="actualBuyPrice"></span></p>
            
            <div id="dataWarning" style="display: none;" class="alert-box"></div>
            
            <p><strong>ç¶œåˆè©•åˆ†ï¼š</strong> <span id="scoreValue"></span></p>
            <p><strong>æ¨è–¦ï¼š</strong> <span id="recommendation" class="recommendation"></span></p>
            
            <h3 style="margin-top: 20px; margin-bottom: 10px;">æŠ€è¡“æŒ‡æ¨™</h3>
            <p id="rsiWarning" style="display: none;" class="warning">è­¦å‘Šï¼šæ­·å²è³‡æ–™ä¸è¶³ 14 å¤©ï¼ŒRSI è¨ˆç®—å¯èƒ½ä¸æº–ç¢ºï¼</p>
            <p><strong>RSIï¼ˆç›¸å°å¼·å¼±æŒ‡æ•¸ï¼‰ï¼š</strong> <span id="rsiValue" class="rsi-value"></span></p>
            <div class="section-note" style="margin-top: 5px; margin-bottom: 15px;">
                <strong>RSI æŒ‡æ¨™èªªæ˜ï¼š</strong><br>
                â€¢ RSI < 30ï¼ˆè¶…è³£ï¼‰ï¼šè‚¡åƒ¹å¯èƒ½è¢«ä½ä¼°ï¼Œé©åˆé€¢ä½è²·é€²<br>
                â€¢ RSI 30-40ï¼ˆåè¶…è³£ï¼‰ï¼šè‚¡åƒ¹ç›¸å°åä½ï¼Œå¯ç•™æ„åå½ˆæ©Ÿæœƒ<br>
                â€¢ RSI 40-60ï¼ˆä¸­æ€§ï¼‰ï¼šå¸‚å ´å¤šç©ºåŠ›é‡ç›¸å°å‡è¡¡<br>
                â€¢ RSI 60-70ï¼ˆåè¶…è²·ï¼‰ï¼šè‚¡åƒ¹ç›¸å°åé«˜ï¼Œæ³¨æ„å›èª¿é¢¨éšª<br>
                â€¢ RSI > 70ï¼ˆè¶…è²·ï¼‰ï¼šè‚¡åƒ¹å¯èƒ½éé«˜ï¼Œè¬¹æ…è¿½é«˜æˆ–è€ƒæ…®è³£å‡º
            </div>
            
            <p id="macdInfo" style="display: none;"><strong>MACD ä¿¡è™Ÿï¼š</strong> <span id="macdSignal"></span></p>
            <div class="section-note" style="margin-top: 5px; margin-bottom: 15px;" id="macdNote">
                <strong>MACD æŒ‡æ¨™èªªæ˜ï¼š</strong><br>
                â€¢ é»ƒé‡‘äº¤å‰ï¼šçŸ­æœŸè¶¨å‹¢ç”±å¼±è½‰å¼·ï¼Œå½¢æˆè²·å…¥ä¿¡è™Ÿï¼Œå»ºè­°çµåˆå…¶ä»–æŒ‡æ¨™ç¢ºèª<br>
                â€¢ æ­»äº¡äº¤å‰ï¼šçŸ­æœŸè¶¨å‹¢ç”±å¼·è½‰å¼±ï¼Œå½¢æˆè³£å‡ºä¿¡è™Ÿï¼Œå»ºè­°è€ƒæ…®æ¸›å€‰æˆ–åœæ<br>
                â€¢ å¤šé ­æ ¼å±€ï¼ˆMACD > Signalï¼‰ï¼šçŸ­æœŸè¶¨å‹¢å‘ä¸Šï¼Œå¯æŒçºŒæŒæœ‰æˆ–é€¢ä½åŠ ç¢¼<br>
                â€¢ ç©ºé ­æ ¼å±€ï¼ˆMACD < Signalï¼‰ï¼šçŸ­æœŸè¶¨å‹¢å‘ä¸‹ï¼Œå»ºè­°è§€æœ›æˆ–ç­‰å¾…è¶¨å‹¢åè½‰<br>
                â€¢ ä¸­æ€§ï¼šè¶¨å‹¢ä¸æ˜ç¢ºï¼Œå»ºè­°ç­‰å¾…æ›´æ¸…æ™°çš„ä¿¡è™Ÿ
            </div>
            
            <h3 style="margin-top: 20px; margin-bottom: 10px;">åƒ¹æ ¼å»ºè­°</h3>
            <p><strong>å»ºè­°è²·å…¥åƒ¹æ ¼ï¼š</strong> <span id="suggestedBuyPrice"></span></p>
            <p><strong>æ­¢æè³£å‡ºåƒ¹æ ¼ï¼š</strong> <span id="stopLossPrice"></span></p>
            <p><strong>ç›ˆåˆ©ç›®æ¨™è³£å‡ºåƒ¹æ ¼ï¼š</strong> <span id="profitTargetPrice"></span></p>
            <p id="optimalSellPrice" style="display: none;">
                <strong>æœªä¾†æœ€ä½³è³£å‡ºåƒ¹æ ¼å»ºè­°ï¼š</strong> <span id="optimalSellPriceValue"></span>
            </p>
            
            <h3 style="margin-top: 20px; margin-bottom: 10px;">é¢¨éšªç®¡ç†åƒæ•¸</h3>
            <p><strong>å‡±åˆ©æŠ•è³‡æ¯”ä¾‹ï¼š</strong> <span id="kellyRatio"></span></p>
            <p><strong>èª¿æ•´å¾Œå‹ç‡ï¼š</strong> <span id="adjustedWinRate"></span></p>
            <p><strong>èª¿æ•´å¾Œè³ ç‡ï¼š</strong> <span id="adjustedOdds"></span></p>
            
            <h3 style="margin-top: 20px; margin-bottom: 10px;">æ³¢å‹•ç‡åˆ†æ</h3>
            <p><strong>æ—¥æ³¢å‹•ç‡ï¼š</strong> <span id="dailyVolatility"></span></p>
            <p><strong>å‘¨æ³¢å‹•ç‡ï¼š</strong> <span id="weeklyVolatility"></span></p>
            <p><strong>æœˆæ³¢å‹•ç‡ï¼š</strong> <span id="monthlyVolatility"></span></p>
            <p><strong>å¹´æ³¢å‹•ç‡ï¼š</strong> <span id="annualVolatility"></span></p>
            
            <div class="disclaimer" style="margin-top: 30px;">
                <h3>âš ï¸ é‡è¦é¢¨éšªè­¦ç¤ºèˆ‡å…è²¬è²æ˜</h3>
                <ul>
                    <li><strong>æœ¬å·¥å…·åƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°</strong></li>
                    <li>å‹ç‡è¨ˆç®—åŸºæ–¼æŠ€è¡“æŒ‡æ¨™æ¨ä¼°ï¼Œ<strong>éå¯¦éš›å›æ¸¬çµæœ</strong>ï¼Œå¯¦éš›å‹ç‡å¯èƒ½å¤§å¹…ä¸åŒ</li>
                    <li>å‡±åˆ©æ¯”ä¾‹ç‚ºç†è«–å€¼ï¼Œå¯¦éš›äº¤æ˜“æ‡‰æ ¹æ“šå€‹äººé¢¨éšªæ‰¿å—èƒ½åŠ›<strong>å¤§å¹…é™ä½æŠ•è³‡æ¯”ä¾‹</strong></li>
                    <li>æŠ€è¡“åˆ†ææœ‰å…¶å±€é™æ€§ï¼Œæ‡‰çµåˆåŸºæœ¬é¢ã€å¸‚å ´ç’°å¢ƒèˆ‡è³‡é‡‘ç®¡ç†</li>
                    <li>éå»è¡¨ç¾ä¸ä»£è¡¨æœªä¾†çµæœï¼ŒæŠ•è³‡æœ‰é¢¨éšªï¼Œè«‹è¬¹æ…è©•ä¼°</li>
                    <li>å»ºè­°ï¼šå¯¦éš›æŠ•è³‡é‡‘é¡ä¸æ‡‰è¶…éå‡±åˆ©æ¯”ä¾‹çš„ <strong>1/4 åˆ° 1/2</strong></li>
                </ul>
                <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #666;">
                    Â© 2025 æ…§é”ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸ ç‰ˆæ¬Šæ‰€æœ‰
                </p>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let stockData = [];
        let industries = new Set();

        // å·¥å…·å‡½æ•¸
        function formatDate(d) {
            const y = d.getFullYear();
            const m = (d.getMonth() + 1).toString().padStart(2, '0');
            const day = d.getDate().toString().padStart(2, '0');
            return `${y}-${m}-${day}`;
        }

        function datesBetween(start, end) {
            const arr = [];
            const cur = new Date(start);
            cur.setHours(0, 0, 0, 0);
            while (cur <= end) {
                arr.push(formatDate(new Date(cur)));
                cur.setDate(cur.getDate() + 1);
            }
            return arr;
        }

        // è¼‰å…¥è‚¡ç¥¨åˆ—è¡¨
        async function loadStockList() {
            const fetchNote = document.getElementById('fetchNote');
            const industryEl = document.getElementById('industry');
            
            try {
                fetchNote.textContent = 'æ­£åœ¨è¼‰å…¥è‚¡ç¥¨åˆ—è¡¨...';
                
                const url = 'https://api.finmindtrade.com/api/v4/data?dataset=TaiwanStockInfo';
                const res = await fetch(url);
                
                if (!res.ok) throw new Error('ç„¡æ³•è¼‰å…¥è‚¡ç¥¨åˆ—è¡¨');
                
                const json = await res.json();
                
                if (json.status === 200 && Array.isArray(json.data)) {
                    stockData = json.data
                        .filter(item => item.type === 'twse' || item.type === 'tpex')
                        .sort((a, b) => a.stock_id.localeCompare(b.stock_id));
                    
                    industries = new Set(stockData.map(item => item.industry_category).filter(Boolean));
                    
                    industryEl.innerHTML = '<option value="">-- è«‹é¸æ“‡é¡è‚¡ --</option>';
                    Array.from(industries).sort().forEach(industry => {
                        const option = document.createElement('option');
                        option.value = industry;
                        option.textContent = industry;
                        industryEl.appendChild(option);
                    });
                    
                    fetchNote.textContent = `å·²è¼‰å…¥ ${stockData.length} æ”¯è‚¡ç¥¨è³‡æ–™`;
                } else {
                    throw new Error('è‚¡ç¥¨åˆ—è¡¨æ ¼å¼ç•°å¸¸');
                }
            } catch (e) {
                console.error('è¼‰å…¥è‚¡ç¥¨åˆ—è¡¨éŒ¯èª¤', e);
                fetchNote.textContent = 'è¼‰å…¥è‚¡ç¥¨åˆ—è¡¨å¤±æ•—ï¼š' + (e.message || e);
                industryEl.innerHTML = '<option value="">è¼‰å…¥å¤±æ•—</option>';
            }
        }

        // é¡è‚¡è®Šæ›´äº‹ä»¶
        document.getElementById('industry').addEventListener('change', (e) => {
            const selectedIndustry = e.target.value;
            const stockSelectEl = document.getElementById('stockSelect');
            
            if (!selectedIndustry) {
                stockSelectEl.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡é¡è‚¡</option>';
                return;
            }
            
            const filteredStocks = stockData.filter(item => item.industry_category === selectedIndustry);
            
            stockSelectEl.innerHTML = '<option value="">-- è«‹é¸æ“‡è‚¡ç¥¨ --</option>';
            filteredStocks.forEach(stock => {
                const option = document.createElement('option');
                option.value = stock.stock_id;
                option.textContent = `${stock.stock_id} ${stock.stock_name}`;
                stockSelectEl.appendChild(option);
            });
        });

        // è‚¡ç¥¨é¸æ“‡äº‹ä»¶
        document.getElementById('stockSelect').addEventListener('change', (e) => {
            const stockId = e.target.value;
            document.getElementById('stockCode').value = stockId;
        });

        // æŠ“å–æ­·å²æ”¶ç›¤åƒ¹
        async function fetchFinMind(stockNo, start, end) {
            const results = {};
            
            const startDateParam = formatDate(start);
            const endDateParam = formatDate(end);
            
            const url = `https://api.finmindtrade.com/api/v4/data?dataset=TaiwanStockPrice&data_id=${stockNo}&start_date=${startDateParam}&end_date=${endDateParam}`;
            
            const res = await fetch(url);
            if (!res.ok) throw new Error('FinMind å›å‚³é 200');
            const json = await res.json();
            
            if (json.status === 200 && Array.isArray(json.data)) {
                if (json.data.length === 0) {
                    throw new Error('æŸ¥ç„¡æ­¤è‚¡ç¥¨ä»£ç¢¼æˆ–æ—¥æœŸç¯„åœå…§ç„¡è³‡æ–™');
                }
                json.data.forEach(row => {
                    const date = row.date;
                    const close = row.close === null || row.close === undefined ? '' : String(row.close).replace(/,/g, '').trim();
                    results[date] = close === '-' ? '' : close;
                });
            } else if (json.status === 404) {
                throw new Error('æŸ¥ç„¡æ­¤è‚¡ç¥¨ä»£ç¢¼æˆ–æ—¥æœŸç¯„åœå…§ç„¡è³‡æ–™');
            } else {
                throw new Error('FinMind API è¿”å›ç•°å¸¸æ ¼å¼');
            }
            
            return results;
        }

        // æŠ“å–æŒ‰éˆ•äº‹ä»¶
        document.getElementById('fetchBtn').addEventListener('click', async () => {
            const stockNo = document.getElementById('stockCode').value.trim();
            const startRaw = document.getElementById('startDate').value;
            const endRaw = document.getElementById('endDate').value;
            const fetchNote = document.getElementById('fetchNote');
            const historicalPricesEl = document.getElementById('historicalPrices');
            
            if (!stockNo) {
                alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼');
                return;
            }
            if (!startRaw || !endRaw) {
                alert('è«‹é¸æ“‡é–‹å§‹èˆ‡çµæŸæ—¥æœŸ');
                return;
            }
            
            const start = new Date(startRaw);
            const end = new Date(endRaw);
            
            if (start > end) {
                alert('é–‹å§‹æ—¥æœŸä¸å¯æ™šæ–¼çµæŸæ—¥æœŸ');
                return;
            }

            fetchNote.textContent = 'é–‹å§‹æŠ“å–è³‡æ–™...';
            
            try {
                const map = await fetchFinMind(stockNo, start, end);
                
                const allDates = datesBetween(start, end);
                const values = allDates
                    .map(d => map[d])
                    .filter(v => v !== undefined && v !== '');
                
                historicalPricesEl.value = values.join(',');
                
                // è‡ªå‹•è¨ˆç®—ç›¸é—œæ¬„ä½
                if (values.length > 0) {
                    const prices = values.map(v => parseFloat(v));
                    document.getElementById('historicalDays').value = prices.length;
                    document.getElementById('historicalLow').value = Math.min(...prices).toFixed(2);
                    document.getElementById('historicalHigh').value = Math.max(...prices).toFixed(2);
                    const avg = prices.reduce((sum, p) => sum + p, 0) / prices.length;
                    document.getElementById('historicalAvg').value = avg.toFixed(2);
                    
                    // è‡ªå‹•å¡«å…¥ç•¶å‰åƒ¹æ ¼ï¼ˆä½¿ç”¨æœ€å¾Œä¸€å€‹æ”¶ç›¤åƒ¹ï¼‰
                    const latestPrice = prices[prices.length - 1];
                    document.getElementById('currentPrice').value = latestPrice.toFixed(2);
                }
                
                fetchNote.textContent = `å…± ${allDates.length} æ—¥ï¼Œæ‰¾åˆ° ${values.length} å€‹äº¤æ˜“æ—¥çš„æ”¶ç›¤åƒ¹ã€‚`;
            } catch (e) {
                console.error(e);
                fetchNote.textContent = 'ç™¼ç”ŸéŒ¯èª¤ï¼š' + (e.message || e);
                alert('æŠ“å–ç™¼ç”ŸéŒ¯èª¤ï¼š' + (e.message || e));
            }
        });

        // æ¸…é™¤æŠ“å–æŒ‰éˆ•
        document.getElementById('clearFetchBtn').addEventListener('click', () => {
            document.getElementById('historicalPrices').value = '';
            document.getElementById('historicalDays').value = '';
            document.getElementById('historicalLow').value = '';
            document.getElementById('historicalHigh').value = '';
            document.getElementById('historicalAvg').value = '';
            document.getElementById('fetchNote').textContent = '';
        });

        // è¡¨å–®æäº¤äº‹ä»¶
        document.getElementById('stockForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const stockCode = document.getElementById('stockCode').value.trim();
            const buyPriceInput = document.getElementById('buyPrice').value.trim();
            const buyPrice = buyPriceInput ? parseFloat(buyPriceInput) : null;
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const historicalDays = parseInt(document.getElementById('historicalDays').value);
            const historicalPricesInput = document.getElementById('historicalPrices').value.trim();
            const historicalPrices = historicalPricesInput.split(',').map(item => parseFloat(item.trim())).filter(num => !isNaN(num));
            const stopLossPercent = parseFloat(document.getElementById('stopLoss').value) / 100 || 0.05;
            const profitTargetPercent = parseFloat(document.getElementById('profitTarget').value) / 100 || 0.10;
            const transactionCost = parseFloat(document.getElementById('transactionCost').value) / 100 || 0.005;
            const slippage = parseFloat(document.getElementById('slippage').value) / 100 || 0.002;
            const leverage = parseFloat(document.getElementById('leverage').value) || 1;
            const marketTrend = parseFloat(document.getElementById('marketTrend').value) / 100 || 0;
            const expectedWinRateInput = document.getElementById('expectedWinRate').value.trim();
            const userProvidedWinRate = expectedWinRateInput ? parseFloat(expectedWinRateInput) / 100 : null;

            if (historicalPrices.length === 0) {
                alert('è«‹å…ˆæŠ“å–æˆ–è¼¸å…¥æ­·å²æ”¶ç›¤åƒ¹');
                return;
            }

            // æ•¸æ“šå……è¶³æ€§æª¢æŸ¥
            const dataWarningEl = document.getElementById('dataWarning');
            let dataWarnings = [];
            
            if (historicalPrices.length < 14) {
                dataWarnings.push('æ­·å²æ•¸æ“šå°‘æ–¼ 14 å¤©ï¼ŒRSI è¨ˆç®—å°‡ä¸æº–ç¢º');
            } else if (historicalPrices.length < 30) {
                dataWarnings.push('å»ºè­°ä½¿ç”¨è‡³å°‘ 30 å¤©æ•¸æ“šä»¥æé«˜åˆ†ææº–ç¢ºæ€§');
            }
            
            if (historicalPrices.length < 26) {
                dataWarnings.push('æ­·å²æ•¸æ“šå°‘æ–¼ 26 å¤©ï¼Œç„¡æ³•è¨ˆç®— MACD æŒ‡æ¨™');
            }
            
            if (dataWarnings.length > 0) {
                dataWarningEl.textContent = 'âš ï¸ æ•¸æ“šè­¦å‘Šï¼š' + dataWarnings.join('ï¼›');
                dataWarningEl.style.display = 'block';
            } else {
                dataWarningEl.style.display = 'none';
            }

            // è¨ˆç®—æ­·å²å¹³å‡åƒ¹
            const historicalAvg = historicalPrices.reduce((sum, price) => sum + price, 0) / historicalPrices.length;
            document.getElementById('historicalAvg').value = historicalAvg.toFixed(2);

            const historicalLow = Math.min(...historicalPrices);
            const historicalHigh = Math.max(...historicalPrices);

            // è¨ˆç®— RSIï¼ˆéœ€è¦è‡³å°‘ 14 å¤©æ•¸æ“šï¼‰
            let rsi = 50; // é è¨­ä¸­æ€§å€¼
            let rsiCalculated = false;
            
            if (historicalPrices.length >= 14) {
                const rsiPeriod = 14;
                let gains = [], losses = [];
                for (let i = 1; i < historicalPrices.length; i++) {
                    const priceChange = historicalPrices[i] - historicalPrices[i - 1];
                    gains.push(priceChange > 0 ? priceChange : 0);
                    losses.push(priceChange < 0 ? Math.abs(priceChange) : 0);
                }

                let avgGain = gains.slice(0, rsiPeriod).reduce((sum, val) => sum + val, 0) / rsiPeriod || 0;
                let avgLoss = losses.slice(0, rsiPeriod).reduce((sum, val) => sum + val, 0) / rsiPeriod || 0;
                const smoothingFactor = 2 / (rsiPeriod + 1);

                for (let i = rsiPeriod; i < gains.length; i++) {
                    avgGain = (gains[i] * smoothingFactor) + (avgGain * (1 - smoothingFactor));
                    avgLoss = (losses[i] * smoothingFactor) + (avgLoss * (1 - smoothingFactor));
                }

                const rs = avgLoss === 0 ? Infinity : avgGain / avgLoss;
                rsi = rs === Infinity ? 100 : 100 - (100 / (1 + rs));
                rsiCalculated = true;
            }

            // RSI è­¦å‘Š
            const rsiWarning = document.getElementById('rsiWarning');
            if (historicalPrices.length < 14) {
                rsiWarning.style.display = 'block';
            } else {
                rsiWarning.style.display = 'none';
            }

            // è¨ˆç®— MACD
            function calculateEMA(prices, period) {
                const k = 2 / (period + 1);
                let ema = prices[0];
                const emaValues = [ema];
                for (let i = 1; i < prices.length; i++) {
                    ema = prices[i] * k + ema * (1 - k);
                    emaValues.push(ema);
                }
                return emaValues;
            }

            let macdSignal = 'neutral';
            let macdValue = 0;
            let macdSignalLine = 0;
            let macdHistogram = 0;
            let macdCalculated = false;

            if (historicalPrices.length >= 26) {
                const ema12 = calculateEMA(historicalPrices, 12);
                const ema26 = calculateEMA(historicalPrices, 26);
                const macdLine = ema12.map((val, idx) => val - ema26[idx]);
                const signalLine = calculateEMA(macdLine, 9);
                
                macdValue = macdLine[macdLine.length - 1];
                macdSignalLine = signalLine[signalLine.length - 1];
                macdHistogram = macdValue - macdSignalLine;
                macdCalculated = true;

                // MACD ä¿¡è™Ÿåˆ¤æ–·ï¼ˆåŠ å…¥è¶¨å‹¢ç¢ºèªï¼‰
                const prevHistogram = macdLine[macdLine.length - 2] - signalLine[signalLine.length - 2];
                
                if (macdHistogram > 0 && prevHistogram <= 0) {
                    macdSignal = 'golden_cross';
                } else if (macdHistogram < 0 && prevHistogram >= 0) {
                    macdSignal = 'death_cross';
                } else if (macdHistogram > 0) {
                    macdSignal = 'bullish';
                } else if (macdHistogram < 0) {
                    macdSignal = 'bearish';
                }
            }

            // è¨ˆç®—æ³¢å‹•ç‡
            const returns = [];
            for (let i = 1; i < historicalPrices.length; i++) {
                returns.push(historicalPrices[i] / historicalPrices[i - 1] - 1);
            }
            const meanReturn = returns.reduce((a, b) => a + b, 0) / returns.length || 0;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - meanReturn, 2), 0) / (returns.length - 1) || 0;
            const dailyVolatility = Math.sqrt(variance) * 100;
            const weeklyVolatility = dailyVolatility * Math.sqrt(5);
            const monthlyVolatility = dailyVolatility * Math.sqrt(21);
            const annualVolatility = dailyVolatility * Math.sqrt(252);

            document.getElementById('volatility').value = annualVolatility.toFixed(2);

            // å‡±åˆ©å…¬å¼è¨ˆç®—
            // 1. è¨ˆç®—å‹ç‡ (p)
            let adjustedP;
            
            if (userProvidedWinRate !== null) {
                // ä½¿ç”¨è€…æä¾›å‹ç‡
                adjustedP = Math.max(0.2, Math.min(0.8, userProvidedWinRate));
            } else {
                // ä½¿ç”¨æŠ€è¡“æŒ‡æ¨™æ¨ä¼°ï¼ˆæ³¨æ„ï¼šé€™åªæ˜¯æ¨ä¼°ï¼Œéå¯¦éš›å›æ¸¬çµæœï¼‰
                const priceRange = historicalHigh - historicalLow;
                const pricePosition = priceRange > 0 ? (currentPrice - historicalLow) / priceRange : 0.5;
                
                // åŸºç¤å‹ç‡ï¼šåƒ¹æ ¼è¶Šæ¥è¿‘ä½é»ï¼ŒåŸºç¤åˆ†ç¨é«˜
                let baseP = 0.45 + (0.5 - pricePosition) * 0.15; // åœ¨ä½é»é™„è¿‘æ™‚ç´„0.53ï¼Œé«˜é»é™„è¿‘æ™‚ç´„0.38
                
                // RSI èª¿æ•´ï¼ˆå¦‚æœè¨ˆç®—å‡ºä¾†äº†ï¼‰
                if (rsiCalculated) {
                    if (rsi < 30) {
                        baseP += 0.10;
                    } else if (rsi > 70) {
                        baseP -= 0.10;
                    } else {
                        baseP += (50 - rsi) / 400; // RSIåé›¢50çš„ç¨‹åº¦å½±éŸ¿å‹ç‡
                    }
                }
                
                // å¸‚å ´è¶¨å‹¢èª¿æ•´
                baseP += marketTrend * 0.3;
                
                // æ³¢å‹•ç‡èª¿æ•´ï¼šé«˜æ³¢å‹•ç‡é™ä½å‹ç‡
                baseP -= (annualVolatility / 100) * 0.08;
                
                // MACD èª¿æ•´
                if (macdCalculated) {
                    if (macdSignal === 'golden_cross') {
                        baseP += 0.08;
                    } else if (macdSignal === 'death_cross') {
                        baseP -= 0.08;
                    }
                }
                
                // é™åˆ¶å‹ç‡åœ¨åˆç†ç¯„åœå…§ (0.2 - 0.8)
                adjustedP = Math.max(0.2, Math.min(0.8, baseP));
            }
            
            const q = 1 - adjustedP;

            // 2. è¨ˆç®—è³ ç‡ (b)ï¼šç›ˆåˆ©ç›®æ¨™ / æ­¢æå¹…åº¦ï¼ˆæ‰£é™¤äº¤æ˜“æˆæœ¬å’Œæ»‘é»ï¼‰
            const totalCost = transactionCost + slippage;
            const profitAfterCost = (profitTargetPercent * leverage) - (totalCost * 2);
            const lossAfterCost = (stopLossPercent * leverage) + (totalCost * 2);
            const b = profitAfterCost / lossAfterCost;

            // 3. å‡±åˆ©å…¬å¼ï¼šf = (bp - q) / b
            const kellyRatio = (b * adjustedP - q) / b;
            
            // 4. èª¿æ•´å‡±åˆ©æ¯”ä¾‹ï¼ˆä¿å®ˆèµ·è¦‹ï¼Œå»ºè­°ä½¿ç”¨ 1/4 åˆ° 1/2 å‡±åˆ©ï¼‰
            const adjustedKelly = Math.max(0, Math.min(1, kellyRatio));
            
            // å‡±åˆ©å…¬å¼è¨ˆç®—å¼
            const kellyFormula = `f = (bÃ—p - q) / b = (${b.toFixed(2)}Ã—${adjustedP.toFixed(2)} - ${q.toFixed(2)}) / ${b.toFixed(2)} = ${kellyRatio.toFixed(4)}`;

            // è©•åˆ†ç³»çµ±ï¼ˆ0-100åˆ†ï¼‰
            let score = 0;
            let scoreReasons = [];
            
            // RSI è©•åˆ†ï¼ˆ20åˆ†ï¼‰
            if (rsiCalculated) {
                if (rsi < 30) {
                    score += 20;
                    scoreReasons.push('RSI è¶…è³£(+20)');
                } else if (rsi > 70) {
                    score += 0;
                    scoreReasons.push('RSI è¶…è²·(+0)');
                } else if (rsi >= 40 && rsi <= 60) {
                    score += 10;
                    scoreReasons.push('RSI ä¸­æ€§(+10)');
                } else if (rsi < 40) {
                    score += 15;
                    scoreReasons.push('RSI åä½(+15)');
                } else {
                    score += 5;
                    scoreReasons.push('RSI åé«˜(+5)');
                }
            } else {
                score += 10;
                scoreReasons.push('RSI ç„¡æ³•è¨ˆç®—(+10 é è¨­)');
            }
            
            // MACD è©•åˆ†ï¼ˆ20åˆ†ï¼‰
            if (macdCalculated) {
                if (macdSignal === 'golden_cross') {
                    score += 20;
                    scoreReasons.push('MACD é»ƒé‡‘äº¤å‰(+20)');
                } else if (macdSignal === 'death_cross') {
                    score += 0;
                    scoreReasons.push('MACD æ­»äº¡äº¤å‰(+0)');
                } else if (macdSignal === 'bullish') {
                    score += 15;
                    scoreReasons.push('MACD å¤šé ­(+15)');
                } else if (macdSignal === 'bearish') {
                    score += 5;
                    scoreReasons.push('MACD ç©ºé ­(+5)');
                } else {
                    score += 10;
                    scoreReasons.push('MACD ä¸­æ€§(+10)');
                }
            } else {
                score += 10;
                scoreReasons.push('MACD ç„¡æ³•è¨ˆç®—(+10 é è¨­)');
            }
            
            // åƒ¹æ ¼ä½ç½®è©•åˆ†ï¼ˆ20åˆ†ï¼‰
            const priceRange = historicalHigh - historicalLow;
            const pricePosition = priceRange > 0 ? (currentPrice - historicalLow) / priceRange : 0.5;
            const priceScore = Math.round((1 - pricePosition) * 20);
            score += priceScore;
            scoreReasons.push(`åƒ¹æ ¼ä½ç½®(+${priceScore})`);
            
            // å‡±åˆ©æ¯”ä¾‹è©•åˆ†ï¼ˆ20åˆ†ï¼‰
            if (adjustedKelly > 0.5) {
                score += 20;
                scoreReasons.push('å‡±åˆ©æ¯”ä¾‹å„ªç•°(+20)');
            } else if (adjustedKelly > 0.25) {
                score += 15;
                scoreReasons.push('å‡±åˆ©æ¯”ä¾‹è‰¯å¥½(+15)');
            } else if (adjustedKelly > 0.15) {
                score += 10;
                scoreReasons.push('å‡±åˆ©æ¯”ä¾‹é©ä¸­(+10)');
            } else if (adjustedKelly > 0.05) {
                score += 5;
                scoreReasons.push('å‡±åˆ©æ¯”ä¾‹åä½(+5)');
            } else {
                score += 0;
                scoreReasons.push('å‡±åˆ©æ¯”ä¾‹æ¥µä½(+0)');
            }
            
            // å¸‚å ´è¶¨å‹¢è©•åˆ†ï¼ˆ10åˆ†ï¼‰
            if (marketTrend > 0.1) {
                score += 10;
                scoreReasons.push('å¼·å‹¢ç‰›å¸‚(+10)');
            } else if (marketTrend > 0) {
                score += 7;
                scoreReasons.push('æº«å’Œç‰›å¸‚(+7)');
            } else if (marketTrend > -0.1) {
                score += 5;
                scoreReasons.push('å¸‚å ´ä¸­æ€§(+5)');
            } else {
                score += 2;
                scoreReasons.push('ç†Šå¸‚ç’°å¢ƒ(+2)');
            }
            
            // æ³¢å‹•ç‡è©•åˆ†ï¼ˆ10åˆ†ï¼‰
            if (annualVolatility < 20) {
                score += 10;
                scoreReasons.push('æ³¢å‹•ç‡ä½(+10)');
            } else if (annualVolatility < 40) {
                score += 7;
                scoreReasons.push('æ³¢å‹•ç‡é©ä¸­(+7)');
            } else if (annualVolatility < 60) {
                score += 4;
                scoreReasons.push('æ³¢å‹•ç‡è¼ƒé«˜(+4)');
            } else {
                score += 2;
                scoreReasons.push('æ³¢å‹•ç‡æ¥µé«˜(+2)');
            }

            // å»ºè­°è²·å…¥åƒ¹æ ¼ï¼ˆä¿®æ­£å®‰å…¨é‚Šéš›é‚è¼¯ï¼‰
            let safetyMargin = marketTrend > 0 ? 0.10 : 0.05; // ç‰›å¸‚æ›´è¬¹æ…ï¼Œéœ€è¦æ›´å¤§å®‰å…¨é‚Šéš›
            
            if (rsiCalculated) {
                if (rsi < 30) {
                    safetyMargin *= 0.6; // RSI è¶…è³£æ™‚é™ä½å®‰å…¨é‚Šéš›è¦æ±‚
                } else if (rsi > 70) {
                    safetyMargin *= 1.8; // RSI è¶…è²·æ™‚æé«˜å®‰å…¨é‚Šéš›è¦æ±‚
                }
            }
            
            const suggestedBuyPrice = currentPrice * (1 - safetyMargin);

            // æ­¢æåƒ¹æ ¼ï¼šåŸºæ–¼å¯¦éš›è²·å…¥åƒ¹æˆ–å»ºè­°è²·å…¥åƒ¹è¨ˆç®—
            let stopLossPrice;
            let stopLossBasePrice;
            if (buyPrice !== null) {
                stopLossBasePrice = buyPrice;
                stopLossPrice = buyPrice * (1 - stopLossPercent);
            } else {
                stopLossBasePrice = suggestedBuyPrice;
                stopLossPrice = suggestedBuyPrice * (1 - stopLossPercent);
            }
            
            // ç›ˆåˆ©ç›®æ¨™åƒ¹æ ¼ï¼šåŸºæ–¼å¯¦éš›è²·å…¥åƒ¹æˆ–ç•¶å‰åƒ¹è¨ˆç®—
            let profitTargetPrice;
            if (buyPrice !== null) {
                profitTargetPrice = buyPrice * (1 + profitTargetPercent);
            } else {
                profitTargetPrice = currentPrice * (1 + profitTargetPercent);
            }

            // æœ€ä½³è³£å‡ºåƒ¹æ ¼
            let optimalSellPrice = null;
            if (buyPrice !== null && buyPrice > 0) {
                let marketTrendAdjustment = marketTrend;
                const bearishAdjustment = marketTrend < 0 ? Math.abs(marketTrend) * 0.5 : 0;
                let rsiAdjustment = 0;
                if (rsiCalculated) {
                    if (rsi > 70) {
                        rsiAdjustment = -0.05;
                    } else if (rsi < 30) {
                        rsiAdjustment = 0.05;
                    }
                }
                const optimalProfitTarget = profitTargetPercent + marketTrendAdjustment - bearishAdjustment + rsiAdjustment;
                const volatilityAdjustment = annualVolatility / 100 * 0.01;
                optimalSellPrice = buyPrice * (1 + Math.max(0, optimalProfitTarget) + volatilityAdjustment);
                optimalSellPrice = Math.max(optimalSellPrice, buyPrice);
            }

            // æ¨è–¦é‚è¼¯ï¼ˆåŸºæ–¼è©•åˆ†ç³»çµ±ï¼‰
            let recommendation = '';
            let recommendationClass = '';
            let recommendationReason = '';
            
            if (score >= 80) {
                recommendation = 'å¼·çƒˆå»ºè­°è²·å…¥';
                recommendationClass = 'buy';
                recommendationReason = `ï¼ˆç¶œåˆè©•åˆ† ${score} åˆ†ï¼Œå¤šé …æŒ‡æ¨™å‘ˆç¾å¼·çƒˆè²·å…¥ä¿¡è™Ÿï¼‰`;
            } else if (score >= 65) {
                recommendation = 'å»ºè­°è²·å…¥';
                recommendationClass = 'buy';
                recommendationReason = `ï¼ˆç¶œåˆè©•åˆ† ${score} åˆ†ï¼Œæ•´é«”æ¢ä»¶è‰¯å¥½ï¼‰`;
            } else if (score >= 50) {
                recommendation = 'å¯è€ƒæ…®è²·å…¥';
                recommendationClass = 'buy';
                recommendationReason = `ï¼ˆç¶œåˆè©•åˆ† ${score} åˆ†ï¼Œæ¢ä»¶å°šå¯ï¼Œå»ºè­°å°é¡è©¦å–®ï¼‰`;
            } else if (score >= 35) {
                recommendation = 'æŒå€‰è§€æœ›';
                recommendationClass = 'hold';
                recommendationReason = `ï¼ˆç¶œåˆè©•åˆ† ${score} åˆ†ï¼Œå»ºè­°ç­‰å¾…æ›´å¥½æ™‚æ©Ÿï¼‰`;
            } else if (score >= 20) {
                recommendation = 'å»ºè­°è§€æœ›';
                recommendationClass = 'hold';
                recommendationReason = `ï¼ˆç¶œåˆè©•åˆ† ${score} åˆ†ï¼Œç•¶å‰ä¸æ˜¯å¥½çš„é€²å ´æ™‚æ©Ÿï¼‰`;
            } else {
                recommendation = 'å»ºè­°è³£å‡ºæˆ–è§€æœ›';
                recommendationClass = 'sell';
                recommendationReason = `ï¼ˆç¶œåˆè©•åˆ† ${score} åˆ†ï¼Œå¤šé …æŒ‡æ¨™å‘ˆç¾è³£å‡ºä¿¡è™Ÿï¼‰`;
            }
            
            // ç‰¹æ®Šæƒ…æ³è¦†è“‹
            if (adjustedKelly <= 0) {
                recommendation = 'ä¸å»ºè­°æŠ•è³‡';
                recommendationClass = 'sell';
                recommendationReason = 'ï¼ˆå‡±åˆ©æ¯”ä¾‹ç‚ºè² ï¼ŒæœŸæœ›å ±é…¬ç‚ºè² ï¼‰';
            } else if (currentPrice >= historicalHigh * 0.98) {
                recommendation = 'å»ºè­°ç­‰å¾…å›èª¿';
                recommendationClass = 'hold';
                recommendationReason = 'ï¼ˆç•¶å‰åƒ¹æ ¼æ¥è¿‘æ­·å²é«˜ä½ï¼‰';
            }

            // é¡¯ç¤ºçµæœ
            document.getElementById('resultStockCode').textContent = stockCode;
            document.getElementById('actualBuyPrice').textContent = buyPrice !== null ? buyPrice.toFixed(2) : 'æœªå¡«å¯«';
            
            document.getElementById('scoreValue').textContent = `${score} / 100 åˆ† (${scoreReasons.join(', ')})`;
            
            const recommendationElement = document.getElementById('recommendation');
            recommendationElement.textContent = `${recommendation} ${recommendationReason}`;
            recommendationElement.className = 'recommendation ' + recommendationClass;

            const rsiElement = document.getElementById('rsiValue');
            if (rsiCalculated) {
                let rsiAdvice = '';
                if (rsi < 30) {
                    rsiAdvice = ' - ğŸ“Š è™•æ–¼è¶…è³£å€ï¼Œè‚¡åƒ¹å¯èƒ½è¢«ä½ä¼°ï¼Œå¯è€ƒæ…®é€¢ä½è²·é€²';
                    rsiElement.className = 'rsi-value oversold';
                } else if (rsi > 70) {
                    rsiAdvice = ' - âš ï¸ è™•æ–¼è¶…è²·å€ï¼Œè‚¡åƒ¹å¯èƒ½éé«˜ï¼Œå»ºè­°è¬¹æ…è¿½é«˜æˆ–è€ƒæ…®è³£å‡º';
                    rsiElement.className = 'rsi-value overbought';
                } else if (rsi >= 40 && rsi <= 60) {
                    rsiAdvice = ' - âœ“ è™•æ–¼ä¸­æ€§å€é–“ï¼Œå¸‚å ´å¤šç©ºåŠ›é‡ç›¸å°å‡è¡¡';
                    rsiElement.className = 'rsi-value neutral';
                } else if (rsi < 40) {
                    rsiAdvice = ' - ğŸ“ˆ åå‘è¶…è³£ï¼Œè‚¡åƒ¹ç›¸å°åä½ï¼Œå¯ç•™æ„åå½ˆæ©Ÿæœƒ';
                    rsiElement.className = 'rsi-value neutral';
                } else {
                    rsiAdvice = ' - ğŸ“‰ åå‘è¶…è²·ï¼Œè‚¡åƒ¹ç›¸å°åé«˜ï¼Œå»ºè­°æ³¨æ„å›èª¿é¢¨éšª';
                    rsiElement.className = 'rsi-value neutral';
                }
                rsiElement.textContent = rsi.toFixed(2) + rsiAdvice;
            } else {
                rsiElement.textContent = 'æ•¸æ“šä¸è¶³ï¼Œç„¡æ³•è¨ˆç®—';
                rsiElement.className = 'rsi-value';
            }

            // é¡¯ç¤º MACD ä¿¡æ¯
            if (macdCalculated) {
                const macdInfoEl = document.getElementById('macdInfo');
                const macdSignalEl = document.getElementById('macdSignal');
                const macdNoteEl = document.getElementById('macdNote');
                macdInfoEl.style.display = 'block';
                macdNoteEl.style.display = 'block';
                
                let macdText = '';
                let macdClass = '';
                let macdAdvice = '';
                
                if (macdSignal === 'golden_cross') {
                    macdText = `é»ƒé‡‘äº¤å‰ï¼ˆè²·å…¥ä¿¡è™Ÿï¼‰MACD: ${macdValue.toFixed(2)}, Signal: ${macdSignalLine.toFixed(2)}, Histogram: ${macdHistogram.toFixed(2)}`;
                    macdClass = 'buy';
                    macdAdvice = ' - ğŸš€ çŸ­æœŸè¶¨å‹¢ç”±å¼±è½‰å¼·ï¼Œå½¢æˆè²·å…¥ä¿¡è™Ÿï¼Œä½†å»ºè­°çµåˆå…¶ä»–æŒ‡æ¨™ç¢ºèª';
                } else if (macdSignal === 'death_cross') {
                    macdText = `æ­»äº¡äº¤å‰ï¼ˆè³£å‡ºä¿¡è™Ÿï¼‰MACD: ${macdValue.toFixed(2)}, Signal: ${macdSignalLine.toFixed(2)}, Histogram: ${macdHistogram.toFixed(2)}`;
                    macdClass = 'sell';
                    macdAdvice = ' - ğŸ“‰ çŸ­æœŸè¶¨å‹¢ç”±å¼·è½‰å¼±ï¼Œå½¢æˆè³£å‡ºä¿¡è™Ÿï¼Œå»ºè­°è€ƒæ…®æ¸›å€‰æˆ–åœæ';
                } else if (macdSignal === 'bullish') {
                    macdText = `å¤šé ­ï¼ˆMACD > Signalï¼‰MACD: ${macdValue.toFixed(2)}, Signal: ${macdSignalLine.toFixed(2)}, Histogram: ${macdHistogram.toFixed(2)}`;
                    macdClass = 'buy';
                    macdAdvice = ' - ğŸ“ˆ ç¶­æŒå¤šé ­æ ¼å±€ï¼ŒçŸ­æœŸè¶¨å‹¢å‘ä¸Šï¼Œå¯æŒçºŒæŒæœ‰æˆ–é€¢ä½åŠ ç¢¼';
                } else if (macdSignal === 'bearish') {
                    macdText = `ç©ºé ­ï¼ˆMACD < Signalï¼‰MACD: ${macdValue.toFixed(2)}, Signal: ${macdSignalLine.toFixed(2)}, Histogram: ${macdHistogram.toFixed(2)}`;
                    macdClass = 'sell';
                    macdAdvice = ' - ğŸ“Š ç¶­æŒç©ºé ­æ ¼å±€ï¼ŒçŸ­æœŸè¶¨å‹¢å‘ä¸‹ï¼Œå»ºè­°è§€æœ›æˆ–ç­‰å¾…è¶¨å‹¢åè½‰';
                } else {
                    macdText = `ä¸­æ€§ MACD: ${macdValue.toFixed(2)}, Signal: ${macdSignalLine.toFixed(2)}, Histogram: ${macdHistogram.toFixed(2)}`;
                    macdClass = 'hold';
                    macdAdvice = ' - âš–ï¸ è¶¨å‹¢ä¸æ˜ç¢ºï¼Œå»ºè­°ç­‰å¾…æ›´æ¸…æ™°çš„ä¿¡è™Ÿ';
                }
                
                macdSignalEl.textContent = macdText + macdAdvice;
                macdSignalEl.className = 'recommendation ' + macdClass;
            } else {
                document.getElementById('macdInfo').style.display = 'none';
                document.getElementById('macdNote').style.display = 'none';
            }

            const safetyMarginPercent = (safetyMargin * 100).toFixed(1);
            document.getElementById('suggestedBuyPrice').textContent = `${suggestedBuyPrice.toFixed(2)} ï¼ˆåŸºæ–¼ç•¶å‰åƒ¹æ ¼ ${currentPrice.toFixed(2)} ä¸‹èª¿ ${safetyMarginPercent}% å®‰å…¨é‚Šéš›ï¼‰`;
            
            const stopLossPriceText = buyPrice !== null 
                ? `${stopLossPrice.toFixed(2)} ï¼ˆåŸºæ–¼è²·å…¥åƒ¹æ ¼ ${buyPrice.toFixed(2)} ä¸‹èª¿ ${(stopLossPercent * 100).toFixed(1)}%ï¼‰`
                : `${stopLossPrice.toFixed(2)} ï¼ˆåŸºæ–¼å»ºè­°è²·å…¥åƒ¹æ ¼ ${suggestedBuyPrice.toFixed(2)} ä¸‹èª¿ ${(stopLossPercent * 100).toFixed(1)}%ï¼‰`;
            document.getElementById('stopLossPrice').textContent = stopLossPriceText;
            
            const profitTargetPriceText = buyPrice !== null
                ? `${profitTargetPrice.toFixed(2)} ï¼ˆåŸºæ–¼è²·å…¥åƒ¹æ ¼ ${buyPrice.toFixed(2)} ä¸Šèª¿ ${(profitTargetPercent * 100).toFixed(1)}%ï¼‰`
                : `${profitTargetPrice.toFixed(2)} ï¼ˆåŸºæ–¼ç•¶å‰åƒ¹æ ¼ ${currentPrice.toFixed(2)} ä¸Šèª¿ ${(profitTargetPercent * 100).toFixed(1)}%ï¼‰`;
            document.getElementById('profitTargetPrice').textContent = profitTargetPriceText;

            const optimalSellPriceElement = document.getElementById('optimalSellPrice');
            const optimalSellPriceValueElement = document.getElementById('optimalSellPriceValue');
            if (buyPrice !== null && optimalSellPrice !== null) {
                optimalSellPriceValueElement.textContent = `${optimalSellPrice.toFixed(2)} ï¼ˆåŸºæ–¼è²·å…¥åƒ¹æ ¼ã€å¸‚å ´è¶¨å‹¢ã€RSI å’Œæ³¢å‹•ç‡ç¶œåˆè¨ˆç®—ï¼‰`;
                optimalSellPriceElement.style.display = 'block';
            } else {
                optimalSellPriceElement.style.display = 'none';
            }

            // å‡±åˆ©æ¯”ä¾‹é¡¯ç¤º
            let kellyAdvice = '';
            if (adjustedKelly <= 0) {
                kellyAdvice = 'âŒ å»ºè­°ï¼šä¸è¦æŠ•è³‡æ­¤æ¨™çš„ï¼ŒæœŸæœ›å ±é…¬ç‚ºè² ';
            } else if (adjustedKelly < 0.05) {
                kellyAdvice = 'âš ï¸ å»ºè­°ï¼šæŠ•è³‡åƒ¹å€¼æ¥µä½ï¼Œå»ºè­°å°‹æ‰¾æ›´å¥½çš„æ©Ÿæœƒ';
            } else if (adjustedKelly < 0.15) {
                kellyAdvice = 'å»ºè­°ï¼šå¯å°é¡è©¦å–®ï¼Œå¯¦éš›æŠ•è³‡é‡‘é¡å»ºè­°ä¸è¶…éç¸½è³‡é‡‘çš„ 3-7%';
            } else if (adjustedKelly < 0.25) {
                kellyAdvice = 'å»ºè­°ï¼šé©åº¦æŠ•è³‡ï¼Œå¯¦éš›æŠ•è³‡é‡‘é¡å»ºè­°ç´„ç¸½è³‡é‡‘çš„ 6-12%';
            } else if (adjustedKelly < 0.50) {
                kellyAdvice = 'å»ºè­°ï¼šè¼ƒä½³æŠ•è³‡æ©Ÿæœƒï¼Œå¯¦éš›æŠ•è³‡é‡‘é¡å»ºè­°ç´„ç¸½è³‡é‡‘çš„ 10-20%';
            } else if (adjustedKelly < 0.75) {
                kellyAdvice = 'å»ºè­°ï¼šå„ªè³ªæŠ•è³‡æ©Ÿæœƒï¼Œå¯¦éš›æŠ•è³‡é‡‘é¡å»ºè­°ç´„ç¸½è³‡é‡‘çš„ 15-30%ï¼ˆä½†è«‹æ³¨æ„é¢¨éšªï¼‰';
            } else {
                kellyAdvice = 'å»ºè­°ï¼šæ¥µä½³æŠ•è³‡æ©Ÿæœƒï¼Œä½†å¯¦éš›æŠ•è³‡ä»å»ºè­°ä¸è¶…éç¸½è³‡é‡‘çš„ 30-40% ä»¥åˆ†æ•£é¢¨éšª';
            }
            
            // åŠ å…¥å‹ç‡ä¾†æºèªªæ˜
            const winRateSource = userProvidedWinRate !== null ? 
                'ï¼ˆä½¿ç”¨æ‚¨è¼¸å…¥çš„é æœŸå‹ç‡ï¼‰' : 
                'ï¼ˆâš ï¸ åŸºæ–¼æŠ€è¡“æŒ‡æ¨™æ¨ä¼°ï¼Œéå¯¦éš›å›æ¸¬çµæœï¼Œåƒ…ä¾›åƒè€ƒï¼‰';

            document.getElementById('adjustedWinRate').textContent = `${(adjustedP * 100).toFixed(2)}% ${winRateSource}`;
            
            // è³ ç‡å»ºè­°
            let oddsAdvice = '';
            if (b < 1) {
                oddsAdvice = 'âŒ é¢¨éšªå ±é…¬æ¯”ä¸ä½³ï¼Œç›ˆåˆ©ç›®æ¨™ä½æ–¼æ­¢æå¹…åº¦ï¼Œå»ºè­°èª¿æ•´åƒæ•¸';
            } else if (b < 1.5) {
                oddsAdvice = 'âš ï¸ é¢¨éšªå ±é…¬æ¯”åä½ï¼Œå»ºè­°æé«˜ç›ˆåˆ©ç›®æ¨™æˆ–é™ä½æ­¢æå¹…åº¦';
            } else if (b < 2) {
                oddsAdvice = 'âœ“ é¢¨éšªå ±é…¬æ¯”åˆç†ï¼Œç¬¦åˆä¸€èˆ¬äº¤æ˜“æ¨™æº–';
            } else if (b < 3) {
                oddsAdvice = 'âœ“âœ“ é¢¨éšªå ±é…¬æ¯”è‰¯å¥½ï¼Œæ¯æ‰¿æ“”1å…ƒé¢¨éšªå¯æœŸæœ›ç²å¾—2-3å…ƒå›å ±';
            } else {
                oddsAdvice = 'âœ“âœ“âœ“ é¢¨éšªå ±é…¬æ¯”å„ªç•°ï¼Œæ¯æ‰¿æ“”1å…ƒé¢¨éšªå¯æœŸæœ›ç²å¾—3å…ƒä»¥ä¸Šå›å ±';
            }
            
            document.getElementById('adjustedOdds').textContent = `${b.toFixed(2)} ï¼ˆæ‰£é™¤äº¤æ˜“æˆæœ¬å’Œæ»‘é»å¾Œçš„å¯¦éš›è³ ç‡ï¼‰- ${oddsAdvice}`;
            
            // å‡±åˆ©æ¯”ä¾‹è­¦å‘Š
            let kellyDisplay = `${(adjustedKelly * 100).toFixed(2)}%<br><small>è¨ˆç®—å¼ï¼š${kellyFormula}</small><br><strong>${kellyAdvice}</strong>`;
            
            if (adjustedKelly <= 0) {
                kellyDisplay = `<span class="warning">${(adjustedKelly * 100).toFixed(2)}%</span><br><small>${kellyFormula}</small><br><strong>${kellyAdvice}</strong>`;
            } else if (adjustedKelly < 0.05) {
                kellyDisplay = `<span class="warning">${(adjustedKelly * 100).toFixed(2)}%</span><br><small>${kellyFormula}</small><br><strong>${kellyAdvice}</strong>`;
            }
            
            if (userProvidedWinRate === null) {
                kellyDisplay += '<br><br><span class="warning">âš ï¸ é‡è¦æé†’ï¼šç”±æ–¼å‹ç‡æ˜¯åŸºæ–¼æŠ€è¡“æŒ‡æ¨™æ¨ä¼°è€Œéå¯¦éš›å›æ¸¬ï¼Œå‡±åˆ©æ¯”ä¾‹åƒ…ä¾›åƒè€ƒã€‚å¯¦éš›æŠ•è³‡å‰è«‹å‹™å¿…æ ¹æ“šæ‚¨çš„äº¤æ˜“æ­·å²èª¿æ•´é æœŸå‹ç‡ã€‚</span>';
            }
            
            document.getElementById('kellyRatio').innerHTML = kellyDisplay;
            
            // æ³¢å‹•ç‡å»ºè­°
            let dailyVolAdvice = '';
            if (dailyVolatility < 1) {
                dailyVolAdvice = 'æ³¢å‹•æ¥µä½ï¼Œé©åˆä¿å®ˆå‹æŠ•è³‡è€…ï¼Œä½†ç²åˆ©ç©ºé–“æœ‰é™';
            } else if (dailyVolatility < 2) {
                dailyVolAdvice = 'æ³¢å‹•è¼ƒä½ï¼Œé¢¨éšªç›¸å°å¯æ§ï¼Œé©åˆç©©å¥å‹æŠ•è³‡';
            } else if (dailyVolatility < 3) {
                dailyVolAdvice = 'æ³¢å‹•é©ä¸­ï¼Œé¢¨éšªèˆ‡æ©Ÿæœƒä¸¦å­˜ï¼Œé©åˆä¸€èˆ¬æŠ•è³‡è€…';
            } else if (dailyVolatility < 5) {
                dailyVolAdvice = 'æ³¢å‹•è¼ƒé«˜ï¼Œéœ€è¦è¼ƒå¼·çš„é¢¨éšªæ‰¿å—èƒ½åŠ›';
            } else {
                dailyVolAdvice = 'æ³¢å‹•æ¥µé«˜ï¼Œé«˜é¢¨éšªé«˜å›å ±ï¼Œåƒ…é©åˆç©æ¥µå‹æŠ•è³‡è€…';
            }

            let annualVolAdvice = '';
            if (annualVolatility < 15) {
                annualVolAdvice = 'å¹´åŒ–æ³¢å‹•ç‡ä½ï¼Œé¡ä¼¼å‚µåˆ¸æˆ–ç¸¾å„ªè‚¡ï¼Œé©åˆé•·æœŸæŒæœ‰';
            } else if (annualVolatility < 25) {
                annualVolAdvice = 'å¹´åŒ–æ³¢å‹•ç‡é©ä¸­ï¼Œé¡ä¼¼å¤§ç›¤æŒ‡æ•¸ï¼Œé©åˆä¸€èˆ¬æŠ•è³‡';
            } else if (annualVolatility < 40) {
                annualVolAdvice = 'å¹´åŒ–æ³¢å‹•ç‡åé«˜ï¼Œéœ€è¦å¯†åˆ‡é—œæ³¨å¸‚å ´è®ŠåŒ–';
            } else if (annualVolatility < 60) {
                annualVolAdvice = 'å¹´åŒ–æ³¢å‹•ç‡å¾ˆé«˜ï¼Œå»ºè­°è¨­å®šè¼ƒå¯¬çš„æ­¢æç©ºé–“';
            } else {
                annualVolAdvice = 'å¹´åŒ–æ³¢å‹•ç‡æ¥µé«˜ï¼Œå±¬æ–¼é«˜é¢¨éšªæŠ•æ©Ÿæ¨™çš„ï¼Œè«‹è¬¹æ…æ“ä½œ';
            }
            
            document.getElementById('dailyVolatility').textContent = `${dailyVolatility.toFixed(2)}% - ${dailyVolAdvice}`;
            document.getElementById('weeklyVolatility').textContent = `${weeklyVolatility.toFixed(2)}% ï¼ˆç”±æ—¥æ³¢å‹•ç‡Ã—âˆš5è¨ˆç®—ï¼‰- ç”¨æ–¼å‘¨ç·šäº¤æ˜“è€…åƒè€ƒ`;
            document.getElementById('monthlyVolatility').textContent = `${monthlyVolatility.toFixed(2)}% ï¼ˆç”±æ—¥æ³¢å‹•ç‡Ã—âˆš21è¨ˆç®—ï¼‰- ç”¨æ–¼æœˆç·šäº¤æ˜“è€…åƒè€ƒ`;
            document.getElementById('annualVolatility').textContent = `${annualVolatility.toFixed(2)}% ï¼ˆç”±æ—¥æ³¢å‹•ç‡Ã—âˆš252è¨ˆç®—ï¼‰- ${annualVolAdvice}`;

            // ç‰¹æ®Šè­¦å‘Š
            if (currentPrice >= historicalHigh * 0.98) {
                alert('âš ï¸ ç•¶å‰åƒ¹æ ¼æ¥è¿‘æ­·å²é«˜ä½ï¼Œå»ºè­°ç­‰å¾…å›èª¿ï¼');
            }

            const resultsDiv = document.getElementById('results');
            resultsDiv.classList.add('show');
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥è‚¡ç¥¨åˆ—è¡¨
        window.addEventListener('DOMContentLoaded', loadStockList);
    </script>
</body>
</html>